female_teacher %>%
clean_2(values_to = "female_teacher") %>%
left_join(teacher) %>%
mutate(male_teacher = n_teacher - female_teacher) %>%
filter(male_teacher > 0)
female_teacher %>%
clean_2(values_to = "female_teacher") %>%
left_join(teacher) %>%
mutate(male_teacher = n_teacher - female_teacher) %>%
filter(male_teacher > 0) %>%
select(-n_teacher) %>%
pivot_longer(c(female_teacher, male_teacher))
female_teacher %>%
clean_2(values_to = "female_teacher") %>%
left_join(teacher) %>%
mutate(male_teacher = n_teacher - female_teacher) %>%
filter(male_teacher > 0) %>%
select(-n_teacher) %>%
pivot_longer(c(female_teacher, male_teacher), "gender", "value")
female_teacher %>%
clean_2(values_to = "female_teacher") %>%
left_join(teacher) %>%
mutate(male_teacher = n_teacher - female_teacher) %>%
filter(male_teacher > 0) %>%
select(-n_teacher) %>%
pivot_longer(c(female_teacher, male_teacher), "gender", "value") %>%
write_rds("cleanded-data/education/female_teacher.rds")
femalte_student %>%
clean_2("female_student") %>%
left_join(school_student) %>%
mutate(male_student = n_student - female_student) %>%
select(-n_student) %>%
pivot_longer(c(female_student, male_student), "gender", "value")
femalte_student %>%
clean_2("female_student") %>%
left_join(school_student) %>%
mutate(male_student = n_student - female_student) %>%
select(-n_student) %>%
pivot_longer(c(female_student, male_student), "gender", "value") %>%
write_rds("cleanded-data/education/female_student.rds")
student_gender %>%
filter(clean_name == "ha_noi")
student_gender <- read_rds("cleanded-data/education/female_student.rds")
teacher_gender <- read_rds("cleanded-data/education/female_teacher.rds")
student_gender %>%
filter(clean_name == "ha_noi")
student_gender %>%
filter(clean_name == "ha_noi") %>%
ggplot(aes(year, value, fill = gender))+
geom_point()+
facet_wrap(education_level)
student_gender %>%
filter(clean_name == "ha_noi") %>%
ggplot(aes(year, value, fill = gender))+
geom_point()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_noi") %>%
ggplot(aes(year, value, coloeo = gender))+
geom_point()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_noi") %>%
ggplot(aes(year, value, color = gender))+
geom_point()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender))+
geom_point()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()
student_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
student_gender %>%
filter(clean_name == "ha_tinh")
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
?icon
runApp('education-dashboard/education-dash-board.R')
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)+
labs(title = "sdfasdf")
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)+
labs(title = "sdfasdf")+
theme(plot.title = element_text(margin = margin(b = 3)))
teacher_gender %>%
filter(clean_name == "ha_tinh") %>%
ggplot(aes(year, value, color = gender, group = gender))+
geom_point()+
geom_line()+
facet_wrap(~education_level)+
labs(title = "sdfasdf")+
theme(plot.title = element_text(margin = margin(b = 30)))
runApp('education-dashboard/education-dash-board.R')
school_stat
rename_education <- function(x){
case_when(x == "cap1" ~ "Elementary school",
x == "cap2" ~ "Middle school",
x == "cap3" ~ "High school")
}
rename_education <- . %>%
mutate(education_level =case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school"))
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
student_gender <- read_rds(here("cleanded-data/education/female_student.rds")) %>%
rename_education()
teacher_gender <- read_rds(here("cleanded-data/education/female_teacher.rds")) %>%
rename_education()
runApp('education-dashboard/education-dash-board.R')
student_gender <- read_rds(here("cleanded-data/education/female_student.rds"))
student_gender
runApp('education-dashboard/education-dash-board.R')
runApp('education-dash-board.R')
factor(letter[1:3])
letter
factor(letters[1:3])
factor(letters[1:3], levels = c("c","a", "b"))
## rename education level to english
rename_education <- . %>%
mutate(education_level = factor(education_level, levels = c("cap1", "cap2", "cap3"),
education_level = case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school")
))
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
## rename education level to english
rename_education <- . %>%
mutate(education_level = factor(education_level, levels = c("cap1", "cap2", "cap3")),
education_level = case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school")
))
## rename education level to english
rename_education <- . %>%
mutate(education_level = factor(education_level, levels = c("cap1", "cap2", "cap3")),
education_level = case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school")
)
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
runApp('education-dashboard/education-dash-board.R')
school_stat
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
school_stat
## rename education level to english
rename_education <- . %>%
mutate(education_level = case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school"),
education_level = factor(education_level,
levels = c("Elementary school", "Middle school", "High school"))
)
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
school_stat
runApp('education-dashboard/education-dash-board.R')
library(shiny); runApp('education-dashboard/education-dash-board.R')
library(shiny); runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
library(tidyverse)
library(shiny)
library(echarts4r)
library(DT)
library(janitor)
library(shinydashboard)
library(glue)
library(plotly)
library(scales)
library(here)
# styling theme and color --------------------------------------------------
theme_facet <- theme_light() +
theme(
strip.text = element_text(
face = "bold",
color = "chocolate3",
hjust = .5,
size = 11
),
text = element_text(family = "Montserrat"),
strip.background = element_rect(fill = "gray90", color = "transparent"),
panel.grid.major.y = element_line(colour = "white", linetype = 3),
plot.background = element_rect(fill = "#E7D5BD"),
panel.background = element_rect(fill = "grey90")
)
my_pal<- c("#62959c", "#c19277", "#e1bc91", "#e3d0b9","#9dad7f", "#726a95",
"#d6b0b1", "#8b5e83")
## rename education level to english-----
rename_education <- . %>%
mutate(education_level = case_when(education_level == "cap1" ~ "Elementary school",
education_level == "cap2" ~ "Middle school",
education_level == "cap3" ~ "High school"),
education_level = factor(education_level,
levels = c("Elementary school", "Middle school", "High school"))
)
## Load the data ----
school_stat <- read_rds(here("cleanded-data/education/n_school-student-teacher.rds")) %>%
rename_education()
hs_graduated <- read_rds(here("cleanded-data/education/highschool_graduated.rds"))
student_gender <- read_rds(here("cleanded-data/education/female_student.rds")) %>%
rename_education()
teacher_gender <- read_rds(here("cleanded-data/education/female_teacher.rds")) %>%
rename_education()
# match display UI and server name
equal_name <- school_stat %>%
distinct(clean_name, dia_phuong)
# load map for echart
geojson_vn <- read_rds(here("cleanded-data/geojson_vnmap.rds"))
df <- school_stat %>%
mutate(year = as.factor(year)) %>%
filter(clean_name == province_selected()) %>%
pivot_longer(c(n_student,n_teacher, n_school, n_class)) %>%
mutate(name = case_when(name == "n_class" ~  "Number of classes",
name == "n_student" ~  "Number of students",
name == "n_teacher" ~  "Number of teachers",
name == "n_school" ~ "Number of schools"))
plot <-  df %>%
ggplot(aes(year, value, color = education_level, group = education_level,
text = glue("Year: {year}
value: {comma(round(value,-1))}")))+
geom_line(size = .4, alpha = .6)+
geom_point(size = .8)+
labs(title =glue("{df$dia_phuong[[1]]} Province"),
subtitle = " ",
x = NULL,
y= NULL,
color = NULL)+
scale_color_manual(values = my_pal[1:3],
labels = c("Elementary", "Middle school", "High school"))+
scale_x_discrete(breaks = seq(2002, 2019, 3))+
scale_y_continuous(labels = comma)+
facet_wrap(~name, scale = "free")+
theme_facet
df<- school_stat %>% filter(dia_phuong == "ha_tinh")
plot <-  df %>%
ggplot(aes(year, value, color = education_level, group = education_level,
text = glue("Year: {year}
value: {comma(round(value,-1))}")))+
geom_line(size = .4, alpha = .6)+
geom_point(size = .8)+
labs(title =glue("{df$dia_phuong[[1]]} Province"),
subtitle = " ",
x = NULL,
y= NULL,
color = NULL)+
scale_color_manual(values = my_pal[1:3],
labels = c("Elementary", "Middle school", "High school"))+
scale_x_discrete(breaks = seq(2002, 2019, 3))+
scale_y_continuous(labels = comma)+
facet_wrap(~name, scale = "free")+
theme_facet
plot <-  df %>%
ggplot(aes(year, value, color = education_level, group = education_level,
text = glue("Year: {year}
value: {comma(round(value,-1))}")))+
geom_line(size = .4, alpha = .6)+
geom_point(size = .8)+
labs(title =glue("{#df$dia_phuong[[1]]} Province"),
subtitle = " ",
x = NULL,
y= NULL,
color = NULL)+
scale_color_manual(values = my_pal[1:3],
labels = c("Elementary", "Middle school", "High school"))+
scale_x_discrete(breaks = seq(2002, 2019, 3))+
scale_y_continuous(labels = comma)+
facet_wrap(~name, scale = "free")+
theme_facet
ggplotly(plot, tooltip = "text") %>%
layout(hovermode = "x")
plot
runApp('education-dashboard/education-dash-board.R')
install.packages("shinythemes")
runApp('education-dashboard/education-dash-board.R')
install.packages("dashboardthemes")
runApp('education-dashboard/education-dash-board.R')
runApp('education-dashboard/education-dash-board.R')
library(tidyverse)
library(here)
read_rds(here("cleanded-data/area-population.rds"))
pop <- read_rds(here("cleanded-data/area-population.rds"))
dtich_danso <- read_csv("raw-data/dientich_danso.csv") %>%
janitor::clean_names()
dtich_danso
dtich_danso <- read_csv("raw-data/dientich_danso.csv") %>%
janitor::clean_names()
# remove the union regions
union_regions <- dtich_danso %>%
arrange(desc(x2011_dien_tich_km2)) %>%
slice(1:7) %>%
pull(dia_phuong) %>%
c(c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long"))
#write_rds(union_regions, "raw-data/filter_unions.rds")
union_regions <- read_rds("raw-data/filter_unions.rds")
dtich_danso <- dtich_danso %>%
filter(!(dia_phuong %in% union_regions)) %>%
pivot_longer(-dia_phuong, names_to = c("year", ".value"), names_pattern = "x(\\d{4})_(.*)") %>%
mutate(dia_phuong = str_to_title(dia_phuong),
year = as_factor(year)) %>%
mutate(dia_phuong = if_else(dia_phuong == "Tp.hồ Chí Minh", "Hồ Chí Minh", dia_phuong)) %>%
mutate(clean_name = janitor::make_clean_names(dia_phuong))
dtich_danso
# add clean name from janitor
dtich_danso
# add clean name from janitor
dtich_danso %>%
distinct(dia_phuong)
# add clean name from janitor
dtich_danso %>%
distinct(dia_phuong) %>%
mutate(clean_name = janitor::make_clean_names(dia_phuong))
# add clean name from janitor
clean_name <- dtich_danso %>%
distinct(dia_phuong) %>%
mutate(clean_name = janitor::make_clean_names(dia_phuong))
dtich_danso <- dtich_danso %>%
filter(!(dia_phuong %in% union_regions)) %>%
pivot_longer(-dia_phuong, names_to = c("year", ".value"), names_pattern = "x(\\d{4})_(.*)") %>%
mutate(dia_phuong = str_to_title(dia_phuong),
year = as_factor(year)) %>%
mutate(dia_phuong = if_else(dia_phuong == "Tp.hồ Chí Minh", "Hồ Chí Minh", dia_phuong)) %>%
inner_join(clean_name)
## clean data
library(tidyverse)
setwd(here::here())
source("raw-data/filter-unions.R")
dtich_danso <- read_csv("raw-data/dientich_danso.csv") %>%
janitor::clean_names()
# area and population -----------------------------------------------------
# add clean name from janitor
clean_name <- dtich_danso %>%
distinct(dia_phuong) %>%
mutate(clean_name = janitor::make_clean_names(dia_phuong))
# remove the union regions
union_regions <- dtich_danso %>%
arrange(desc(x2011_dien_tich_km2)) %>%
slice(1:7) %>%
pull(dia_phuong) %>%
c(c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long"))
#write_rds(union_regions, "raw-data/filter_unions.rds")
union_regions <- read_rds("raw-data/filter_unions.rds")
dtich_danso <- dtich_danso %>%
filter(!(dia_phuong %in% union_regions)) %>%
pivot_longer(-dia_phuong, names_to = c("year", ".value"), names_pattern = "x(\\d{4})_(.*)") %>%
mutate(dia_phuong = str_to_title(dia_phuong),
year = as_factor(year)) %>%
mutate(dia_phuong = if_else(dia_phuong == "Tp.hồ Chí Minh", "Hồ Chí Minh", dia_phuong)) %>%
inner_join(clean_name)
dtich_danso
write_rds(dtich_danso, "cleanded-data/area-population.rds")
gioi_tinh <- read_csv("raw-data/gioitinh.csv") %>%
janitor::clean_names()
gioi_tinh <- gioi_tinh %>%
filter(!(tinh_thanh_pho %in% union_regions)) %>%
filter(!tinh_thanh_pho %in% c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long")) %>%
mutate(across(everything(), as.character)) %>%
pivot_longer(-tinh_thanh_pho, names_to = c("category", "year"), names_pattern = "(.*)_(\\d{4})",
names_repair = "minimal") %>%
mutate(category = case_when(str_detect(category, "nam")~ "male",
str_detect(category, "nu")~  "female",
str_detect(category, "nong_thon")~ "rural",
str_detect(category, "thanh_thi")~ "urban",
TRUE ~ "total")) %>%
mutate(year = as_factor(year))
gioi_tinh
gioi_tinh <- gioi_tinh %>%
filter(!(tinh_thanh_pho %in% union_regions)) %>%
filter(!tinh_thanh_pho %in% c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long")) %>%
mutate(across(everything(), as.character)) %>%
pivot_longer(-tinh_thanh_pho, names_to = c("category", "year"), names_pattern = "(.*)_(\\d{4})",
names_repair = "minimal") %>%
mutate(category = case_when(str_detect(category, "nam")~ "male",
str_detect(category, "nu")~  "female",
str_detect(category, "nong_thon")~ "rural",
str_detect(category, "thanh_thi")~ "urban",
TRUE ~ "total")) %>%
mutate(year = as_factor(year)) %>%
inner_join(clean_name, by =c("tinh_thanh_pho" = "dia_phuong"))
gioi_tinh
gioi_tinh <- read_csv("raw-data/gioitinh.csv") %>%
janitor::clean_names()
gioi_tinh <- gioi_tinh %>%
filter(!(tinh_thanh_pho %in% union_regions)) %>%
filter(!tinh_thanh_pho %in% c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long")) %>%
mutate(across(everything(), as.character)) %>%
pivot_longer(-tinh_thanh_pho, names_to = c("category", "year"), names_pattern = "(.*)_(\\d{4})",
names_repair = "minimal") %>%
mutate(category = case_when(str_detect(category, "nam")~ "male",
str_detect(category, "nu")~  "female",
str_detect(category, "nong_thon")~ "rural",
str_detect(category, "thanh_thi")~ "urban",
TRUE ~ "total")) %>%
mutate(year = as_factor(year))
gioi_tinh
clean_name
gioi_tinh <- read_csv("raw-data/gioitinh.csv") %>%
janitor::clean_names()
gioi_tinh <- gioi_tinh %>%
filter(!(tinh_thanh_pho %in% union_regions)) %>%
filter(!tinh_thanh_pho %in% c("Ðồng bằng sông Hồng","Ðông Nam Bộ", "Ðồng bằng sông Cửu Long")) %>%
mutate(across(everything(), as.character)) %>%
pivot_longer(-tinh_thanh_pho, names_to = c("category", "year"), names_pattern = "(.*)_(\\d{4})",
names_repair = "minimal") %>%
mutate(category = case_when(str_detect(category, "nam")~ "male",
str_detect(category, "nu")~  "female",
str_detect(category, "nong_thon")~ "rural",
str_detect(category, "thanh_thi")~ "urban",
TRUE ~ "total")) %>%
mutate(year = as_factor(year)) %>%
inner_join(clean_name, by =c("tinh_thanh_pho" = "dia_phuong"))
gioi_tinh
write_rds(gioi_tinh, "cleanded-data/sex.rds")
# labor -------------------------------------------------------------------
laodong <-  read_csv("raw-data/laodong.csv") %>%
janitor::clean_names() %>%
filter_union() %>%
mutate(year = as_factor(year))
laodong
# labor -------------------------------------------------------------------
laodong <-  read_csv("raw-data/laodong.csv") %>%
janitor::clean_names() %>%
filter_union() %>%
mutate(year = as_factor(year)) %>%
inner_join(clean_name, by =c("tinh_thanh_pho" = "dia_phuong"))
laodong
write_rds(laodong, "cleanded-data/labor.rds")
dn1 <- read_csv("raw-data/so_doanhnghiep.csv") %>%
janitor::clean_names() %>%
filter_union() %>%
rename(n_company = value)
dn2 <- read_csv("raw-data/loinhuan_dn.csv") %>%
janitor::clean_names() %>%
filter_union() %>%
rename(company_revenue = value)
dn1 %>%
full_join(dn2) %>%
mutate(year = as_factor(year))
dn1 %>%
full_join(dn2) %>%
mutate(year = as_factor(year)) %>%
inner_join(clean_name, by =c("tinh_thanh_pho" = "dia_phuong")) %>%
write_rds("cleanded-data/company.rds")
read_csv("raw-data/labor-by-age.csv") %>%
janitor::clean_names() %>%
pivot_longer(-nhom_tuoi) %>%
mutate(nhom_tuoi = if_else(nhom_tuoi =='TỔNG SỐ', "total", nhom_tuoi)) %>%
transmute(nhom_tuoi, year = parse_number(name), n_labor = value)
# render company's revenue and labor force report --------------------------------
rmarkdown::render("Analyzing-vn-companu-labor.Rmd",
output_file = "final-result/Analyzing-company-labor",envir = new.env())
